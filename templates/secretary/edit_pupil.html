<!-- Scrollable Main Content -->
    <div class="main-content">
      <div class="card">
        <div class="card-header bg-secondary text-white">
          <h5 class="card-title mb-0">
            <i class="bi bi-pencil"></i> Edit Pupil Details
          </h5>
        </div>
        <div class="card-body">
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
              {% endfor %}
            {% endif %}
          {% endwith %}

          <form method="POST" action="{{ url_for('secretary.edit_pupil', pupil_id=pupil.id) }}">
            <div class="row">
              <!-- Basic Information -->
              <div class="col-md-6">
                <h6 class="text-primary mb-3">
                  <i class="bi bi-info-circle"></i> Basic Information
                </h6>

                <div class="mb-3">
                  <label for="admission_number" class="form-label">Admission Number</label>
                  <div class="admission-number-display">{{ pupil.admission_number }}</div>
                  <small class="text-muted">Admission number cannot be changed</small>
                </div>

                <div class="mb-3">
                  <label for="first_name" class="form-label">First Name <span class="text-danger">*</span></label>
                  <input
                    type="text"
                    class="form-control"
                    id="first_name"
                    name="first_name"
                    value="{{ pupil.first_name or '' }}"
                    required
                  />
                </div>

                <div class="mb-3">
                  <label for="last_name" class="form-label">Last Name <span class="text-danger">*</span></label>
                  <input
                    type="text"
                    class="form-control"
                    id="last_name"
                    name="last_name"
                    value="{{ pupil.last_name or '' }}"
                    required
                  />
                </div>

                <div class="mb-3">
                  <label for="date_of_birth" class="form-label">Date of Birth <span class="text-danger">*</span></label>
                  <input
                    type="date"
                    class="form-control"
                    id="date_of_birth"
                    name="date_of_birth"
                    value="{{ pupil.date_of_birth.strftime('%Y-%m-%d') if pupil.date_of_birth else '' }}"
                    required
                  />
                </div>

                <div class="mb-3">
                  <label for="gender" class="form-label">Gender <span class="text-danger">*</span></label>
                  <select class="form-select" id="gender" name="gender" required>
                    <option value="">Select Gender</option>
                    <option value="Male" {{ 'selected' if pupil.gender == 'Male' else '' }}>Male</option>
                    <option value="Female" {{ 'selected' if pupil.gender == 'Female' else '' }}>Female</option>
                  </select>
                </div>

                <div class="mb-3">
                  <label for="status" class="form-label">Status</label>
                  <select class="form-select" id="status" name="status">
                    <option value="Active" {{ 'selected' if pupil.status == 'Active' else '' }}>Active</option>
                    <option value="Inactive" {{ 'selected' if pupil.status == 'Inactive' else '' }}>Inactive</option>
                    <option value="Suspended" {{ 'selected' if pupil.status == 'Suspended' else '' }}>Suspended</option>
                    <option value="Graduated" {{ 'selected' if pupil.status == 'Graduated' else '' }}>Graduated</option>
                  </select>
                </div>
              </div>

              <!-- Contact Information -->
              <div class="col-md-6">
                <h6 class="text-primary mb-3">
                  <i class="bi bi-telephone"></i> Contact Information
                </h6>

                <div class="mb-3">
                  <label for="address" class="form-label">Address</label>
                  <textarea class="form-control" id="address" name="address" rows="2">{{ pupil.address or '' }}</textarea>
                </div>

                <div class="mb-3">
                  <label for="nationality" class="form-label">Nationality</label>
                  <select class="form-select" id="nationality" name="nationality">
                    <option value="">Select Nationality</option>
                    <option value="Burundi" {{ 'selected' if pupil.nationality == 'Burundi' else '' }}>Burundi</option>
                    <option value="Djibouti" {{ 'selected' if pupil.nationality == 'Djibouti' else '' }}>Djibouti</option>
                    <option value="Eritrea" {{ 'selected' if pupil.nationality == 'Eritrea' else '' }}>Eritrea</option>
                    <option value="Ethiopia" {{ 'selected' if pupil.nationality == 'Ethiopia' else '' }}>Ethiopia</option>
                    <option value="Kenya" {{ 'selected' if pupil.nationality == 'Kenya' else '' }}>Kenya</option>
                    <option value="Rwanda" {{ 'selected' if pupil.nationality == 'Rwanda' else '' }}>Rwanda</option>
                    <option value="Somalia" {{ 'selected' if pupil.nationality == 'Somalia' else '' }}>Somalia</option>
                    <option value="South Sudan" {{ 'selected' if pupil.nationality == 'South Sudan' else '' }}>South Sudan</option>
                    <option value="Sudan" {{ 'selected' if pupil.nationality == 'Sudan' else '' }}>Sudan</option>
                    <option value="Tanzania" {{ 'selected' if pupil.nationality == 'Tanzania' else '' }}>Tanzania</option>
                    <option value="Uganda" {{ 'selected' if pupil.nationality == 'Uganda' else '' }}>Uganda</option>
                  </select>
                </div>

                <div class="mb-3">
                  <label for="phone_number" class="form-label">Phone Number</label>
                  <input
                    type="tel"
                    class="form-control"
                    id="phone_number"
                    name="phone_number"
                    value="{{ pupil.phone_number or '' }}"
                  />
                </div>

                <div class="mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    name="email"
                    value="{{ pupil.email or '' }}"
                  />
                </div>
              </div>
            </div>

            <div class="row">
              <!-- Parent Information -->
              <div class="col-md-6">
                <h6 class="text-primary mb-3">
                  <i class="bi bi-person-heart"></i> Parent/Guardian Information
                </h6>

                <div class="mb-3">
                  <label for="parent_name" class="form-label">Parent/Guardian Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="parent_name"
                    name="parent_name"
                    value="{{ pupil.parent_name or '' }}"
                  />
                </div>

                <div class="mb-3">
                  <label for="parent_phone" class="form-label">Parent/Guardian Phone</label>
                  <input
                    type="tel"
                    class="form-control"
                    id="parent_phone"
                    name="parent_phone"
                    value="{{ pupil.parent_phone or '' }}"
                  />
                </div>

                <div class="mb-3">
                  <label for="parent_email" class="form-label">Parent/Guardian Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="parent_email"
                    name="parent_email"
                    value="{{ pupil.parent_email or '' }}"
                  />
                </div>
              </div>

              <!-- Emergency Contact -->
              <div class="col-md-6">
                <h6 class="text-primary mb-3">
                  <i class="bi bi-exclamation-triangle"></i> Emergency Contact
                </h6>

                <div class="mb-3">
                  <label for="emergency_contact_name" class="form-label">Emergency Contact Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="emergency_contact_name"
                    name="emergency_contact_name"
                    value="{{ pupil.emergency_contact_name or '' }}"
                  />
                </div>

                <div class="mb-3">
                  <label for="emergency_contact_phone" class="form-label">Emergency Contact Phone</label>
                  <input
                    type="tel"
                    class="form-control"
                    id="emergency_contact_phone"
                    name="emergency_contact_phone"
                    value="{{ pupil.emergency_contact_phone or '' }}"
                  />
                </div>
              </div>
            </div>

            <div class="row">
              <!-- Academic Information -->
              <div class="col-md-6">
                <h6 class="text-primary mb-3">
                  <i class="bi bi-book"></i> Academic Information
                </h6>

                <div class="mb-3">
                  <label for="current_class_id" class="form-label">Current Class</label>
                  <select class="form-select" id="current_class_id" name="current_class_id">
                    <option value="">Select Class</option>
                    {% for school_class in classes %}
                    <option value="{{ school_class.id }}" {{ 'selected' if pupil.current_class_id == school_class.id else '' }}>
                      {{ school_class.name }}
                    </option>
                    {% endfor %}
                  </select>
                </div>

                <div class="mb-3">
                  <label for="current_stream_id" class="form-label">Current Stream</label>
                  <select class="form-select" id="current_stream_id" name="current_stream_id">
                    <option value="">Select Stream</option>
                    {% for stream in streams %}
                    <option value="{{ stream.id }}" {{ 'selected' if pupil.current_stream_id == stream.id else '' }}>
                      {{ stream.name }}
                    </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>

            <div class="d-flex gap-2 mt-4">
              <button type="submit" class="btn btn-success">
                <i class="bi bi-check-circle"></i> Update Pupil
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Function to convert text to sentence case with hyphen support
      function toSentenceCase(text) {
        if (!text) return text;
        return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();
      }

      // Function to convert address text with hyphen support
      function toAddressCase(text) {
        if (!text) return text;
        return text.split('-').map(word => toSentenceCase(word.trim())).join('-');
      }

      // Apply case conversion to fields
      document.addEventListener('DOMContentLoaded', function() {
        // Auto-hide flash messages after 2 seconds
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
          setTimeout(() => {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          }, 2000);
        });

        // Apply sentence case to name fields
        const nameFields = [
          'first_name', 'last_name', 'parent_name', 'emergency_contact_name'
        ];

        nameFields.forEach(fieldId => {
          const input = document.getElementById(fieldId);
          if (input) {
            input.addEventListener('input', function() {
              this.value = toSentenceCase(this.value);
            });
            input.addEventListener('paste', function() {
              setTimeout(() => {
                this.value = toSentenceCase(this.value);
              }, 0);
            });
          }
        });

        // Apply address case to address field
        const addressField = document.getElementById('address');
        if (addressField) {
          addressField.addEventListener('input', function() {
            this.value = toAddressCase(this.value);
          });
          addressField.addEventListener('paste', function() {
            setTimeout(() => {
              this.value = toAddressCase(this.value);
            }, 0);
          });
        }
      });

      function hideSidebar() {
        const sidebar = document.getElementById("sidebar");
        const welcomeCard = document.getElementById("welcome-card");
        const mainContent = document.querySelector(".main-content");

        if (window.innerWidth <= 768) {
          sidebar.classList.add("hidden");
          welcomeCard.style.left = "0";
          mainContent.style.marginLeft = "0";
        } else {
          sidebar.style.display = "none";
          welcomeCard.style.left = "0";
          mainContent.style.marginLeft = "0";
        }
        document.getElementById("showBtn").style.display = "block";
      }

      function showSidebar() {
        const sidebar = document.getElementById("sidebar");
        const welcomeCard = document.getElementById("welcome-card");
        const mainContent = document.querySelector(".main-content");

        sidebar.classList.remove("hidden");
        sidebar.style.display = "block";

        if (window.innerWidth > 768) {
          welcomeCard.style.left = "16.666667%";
          mainContent.style.marginLeft = "16.666667%";
        } else {
          welcomeCard.style.left = "0";
          mainContent.style.marginLeft = "0";
        }
        document.getElementById("showBtn").style.display = "none";
      }

      // Handle window resize
      window.addEventListener('resize', function() {
        const sidebar = document.getElementById("sidebar");
        const welcomeCard = document.getElementById("welcome-card");
        const mainContent = document.querySelector(".main-content");

        if (window.innerWidth > 768) {
          if (!sidebar.classList.contains("hidden")) {
            welcomeCard.style.left = "16.666667%";
            mainContent.style.marginLeft = "16.666667%";
          }
        } else {
          welcomeCard.style.left = "0";
          mainContent.style.marginLeft = "0";
        }
      });
    </script>
    
    {% include 'footer.html' %}