<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register Pupil</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        scroll-behavior: smooth;
      }

      #sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 16.666667%; /* col-md-2 equivalent */
        min-height: 100vh;
        background-color: lightblue !important;
        z-index: 1000;
        transition: transform 0.3s ease;
      }

      #welcome-card {
        position: fixed;
        top: 0;
        left: 16.666667%; /* col-md-2 width */
        right: 0;
        background-color: lightgreen;
        z-index: 999;
        border: none;
        border-radius: 0;
      }

      .main-content {
        margin-top: 80px; /* Height of welcome card */
        margin-left: 16.666667%; /* Width of sidebar */
        padding: 20px;
        height: calc(100vh - 80px);
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      @media (max-width: 768px) {
        #sidebar {
          width: 100%;
          transform: translateX(0);
        }

        #sidebar.hidden {
          transform: translateX(-100%);
        }

        #welcome-card {
          left: 0;
          top: 0;
        }

        .main-content {
          margin-left: 0;
          margin-top: 80px;
        }

        .btn-close {
          font-size: 0.6em !important;
        }

        /* Responsive form inputs for mobile */
        .form-control, .form-select, .form-control-sm {
          font-size: 14px !important;
          padding: 0.375rem 0.5rem !important;
          height: calc(1.5em + 0.75rem + 2px) !important;
        }

        textarea.form-control {
          font-size: 14px !important;
          padding: 0.375rem 0.5rem !important;
        }

        .form-label {
          font-size: 14px !important;
          margin-bottom: 0.25rem !important;
        }
      }

      @media (min-width: 769px) and (max-width: 1200px) {
        /* Medium screens - slightly larger inputs */
        .form-control, .form-select {
          font-size: 16px !important;
          padding: 0.5rem 0.75rem !important;
        }

        textarea.form-control {
          font-size: 16px !important;
          padding: 0.5rem 0.75rem !important;
        }
      }

      @media (min-width: 1201px) {
        /* Large screens - full size inputs */
        .form-control, .form-select {
          font-size: 16px !important;
          padding: 0.625rem 0.75rem !important;
        }

        textarea.form-control {
          font-size: 16px !important;
          padding: 0.625rem 0.75rem !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- Fixed Sidebar -->
    <div
      id="sidebar"
      class="bg-light"
    >
      <button
        class="btn-close"
        style="position: absolute; top: 0; right: 0; font-size: 0.8em"
        onclick="hideSidebar()"
      ></button>
      <div
        class="container-fluid p-3 d-flex flex-column justify-content-center align-items-center"
        style="height: calc(100vh - 60px)"
      >
        <div class="d-flex flex-column gap-2">
          <button
            class="btn btn-success btn-sm"
            onclick="window.location.href='/secretary/'"
          >
            <i class="bi bi-house"></i> Dashboard
          </button>
          <button
            class="btn btn-primary btn-sm"
            onclick="window.location.href='/secretary/register-pupil'"
          >
            <i class="bi bi-person-plus"></i> Register Pupils
          </button>
          <button
            class="btn btn-secondary btn-sm"
            onclick="window.location.href='/secretary/manage-pupils'"
          >
            <i class="bi bi-people"></i> Manage Pupils
          </button>
        </div>
      </div>
      <div class="d-flex flex-column justify-content-end h-100 pb-3">
        <a href="/auth/logout" class="btn btn-danger btn-sm"
          ><i class="bi bi-box-arrow-right"></i> Logout</a
        >
      </div>
    </div>

    <!-- Fixed Welcome Card -->
    <div id="welcome-card" class="card">
      <div class="card-body">
        <button
          id="showBtn"
          style="
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 0.8em;
            background: white;
            border: 1px solid black;
            color: black;
            font-weight: bold;
            display: none;
            z-index: 1001;
          "
          onclick="showSidebar()"
        >
          <i class="bi bi-chevron-right"></i>
        </button>
        <h5 class="card-title" style="color: blue; font-weight: bold">
          Welcome Secretary
        </h5>
      </div>
    </div>

    <!-- Scrollable Main Content -->
    <div class="main-content">
            <div class="card" style="flex: 1; display: flex; flex-direction: column;">
              <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">
                  <i class="bi bi-person-plus"></i> Register New Pupil
                </h5>
              </div>
              <div class="card-body" style="flex: 1; overflow-y: auto; padding-bottom: 20px;">
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %} {% for category, message in messages %}
                <div
                  class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show"
                  role="alert"
                >
                  {{ message }}
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="alert"
                  ></button>
                </div>
                {% endfor %} {% endif %} {% endwith %}

                <form
                  method="POST"
                  action="{{ url_for('secretary.register_pupil') }}"
                >
                  <div class="row">
                    <!-- Basic Information -->
                    <div class="col-md-6">
                      <h6 class="text-primary mb-3">
                        <i class="bi bi-info-circle"></i> Basic Information
                      </h6>

                      <div class="mb-3">
                        <label for="first_name" class="form-label"
                          >First Name <span class="text-danger">*</span></label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="first_name"
                          name="first_name"
                          required
                        />
                      </div>

                      <div class="mb-3">
                        <label for="last_name" class="form-label"
                          >Last Name <span class="text-danger">*</span></label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="last_name"
                          name="last_name"
                          required
                        />
                      </div>

                      <div class="mb-3">
                        <label for="date_of_birth" class="form-label"
                          >Date of Birth
                          <span class="text-danger">*</span></label
                        >
                        <input
                          type="date"
                          class="form-control"
                          id="date_of_birth"
                          name="date_of_birth"
                          required
                        />
                      </div>

                      <div class="mb-3">
                        <label for="gender" class="form-label"
                          >Gender <span class="text-danger">*</span></label
                        >
                        <select
                          class="form-select"
                          id="gender"
                          name="gender"
                          required
                        >
                          <option value="">Select Gender</option>
                          <option value="Male">Male</option>
                          <option value="Female">Female</option>
                        </select>
                      </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="col-md-6">
                      <h6 class="text-primary mb-3">
                        <i class="bi bi-telephone"></i> Contact Information
                      </h6>

                      <div class="mb-3">
                        <label for="address" class="form-label">Address</label>
                        <textarea
                          class="form-control"
                          id="address"
                          name="address"
                          rows="2"
                        ></textarea>
                      </div>

                      <div class="mb-3">
                        <label for="nationality" class="form-label">Nationality</label>
                        <select class="form-select" id="nationality" name="nationality">
                          <option value="">Select Nationality</option>
                          <option value="Burundi">Burundi</option>
                          <option value="Djibouti">Djibouti</option>
                          <option value="Eritrea">Eritrea</option>
                          <option value="Ethiopia">Ethiopia</option>
                          <option value="Kenya">Kenya</option>
                          <option value="Rwanda">Rwanda</option>
                          <option value="Somalia">Somalia</option>
                          <option value="South Sudan">South Sudan</option>
                          <option value="Sudan">Sudan</option>
                          <option value="Tanzania">Tanzania</option>
                          <option value="Uganda">Uganda</option>
                        </select>
                      </div>

                      <div class="mb-3">
                        <label for="phone_number" class="form-label"
                          >Phone Number</label
                        >
                        <input
                          type="tel"
                          class="form-control"
                          id="phone_number"
                          name="phone_number"
                        />
                      </div>

                      <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input
                          type="email"
                          class="form-control"
                          id="email"
                          name="email"
                        />
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <!-- Parent Information -->
                    <div class="col-md-6">
                      <h6 class="text-primary mb-3">
                        <i class="bi bi-person-heart"></i> Parent/Guardian
                        Information
                      </h6>

                      <div class="mb-3">
                        <label for="parent_name" class="form-label"
                          >Parent/Guardian Name</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="parent_name"
                          name="parent_name"
                        />
                      </div>

                      <div class="mb-3">
                        <label for="parent_phone" class="form-label"
                          >Parent/Guardian Phone</label
                        >
                        <input
                          type="tel"
                          class="form-control"
                          id="parent_phone"
                          name="parent_phone"
                        />
                      </div>

                      <div class="mb-3">
                        <label for="parent_email" class="form-label"
                          >Parent/Guardian Email</label
                        >
                        <input
                          type="email"
                          class="form-control"
                          id="parent_email"
                          name="parent_email"
                        />
                      </div>
                    </div>

                    <!-- Emergency Contact -->
                    <div class="col-md-6">
                      <h6 class="text-primary mb-3">
                        <i class="bi bi-exclamation-triangle"></i> Emergency
                        Contact
                      </h6>

                      <div class="mb-3">
                        <label for="emergency_contact_name" class="form-label"
                          >Emergency Contact Name</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="emergency_contact_name"
                          name="emergency_contact_name"
                        />
                      </div>

                      <div class="mb-3">
                        <label for="emergency_contact_phone" class="form-label"
                          >Emergency Contact Phone</label
                        >
                        <input
                          type="tel"
                          class="form-control"
                          id="emergency_contact_phone"
                          name="emergency_contact_phone"
                        />
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <!-- Academic Information -->
                    <div class="col-md-6">
                      <h6 class="text-primary mb-3">
                        <i class="bi bi-book"></i> Academic Information
                      </h6>

                      <div class="mb-3">
                        <label for="current_class_id" class="form-label"
                          >Current Class</label
                        >
                        <select
                          class="form-select"
                          id="current_class_id"
                          name="current_class_id"
                        >
                          <option value="">Select Class</option>
                          {% for school_class in classes %}
                          <option value="{{ school_class.id }}">
                            {{ school_class.name }}
                          </option>
                          {% endfor %}
                        </select>
                      </div>

                      <div class="mb-3">
                        <label for="current_stream_id" class="form-label"
                          >Current Stream</label
                        >
                        <select
                          class="form-select"
                          id="current_stream_id"
                          name="current_stream_id"
                        >
                          <option value="">Select Stream</option>
                          {% for stream in streams %}
                          <option value="{{ stream.id }}">
                            {{ stream.name }}
                          </option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>

                  <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-success">
                      <i class="bi bi-check-circle"></i> Register Pupil
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
    <script>
      // Function to convert text to sentence case with hyphen support
      function toSentenceCase(text) {
        if (!text) return text;
        return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();
      }

      // Function to convert address text with hyphen support
      function toAddressCase(text) {
        if (!text) return text;
        return text.split('-').map(word => toSentenceCase(word.trim())).join('-');
      }

      // Apply case conversion to fields
      document.addEventListener('DOMContentLoaded', function() {
        // Auto-hide flash messages after 2 seconds
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
          setTimeout(() => {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          }, 2000);
        });

        const nameFields = [
          'first_name',
          'last_name',
          'parent_name',
          'emergency_contact_name'
        ];

        const addressFields = [
          'address'
        ];

        // Apply sentence case to name fields
        nameFields.forEach(fieldId => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.addEventListener('input', function() {
              const cursorPosition = this.selectionStart;
              this.value = toSentenceCase(this.value);
              this.setSelectionRange(cursorPosition, cursorPosition);
            });

            // Also handle paste events
            field.addEventListener('paste', function() {
              setTimeout(() => {
                this.value = toSentenceCase(this.value);
              }, 0);
            });
          }
        });

        // Apply address case to address fields (with hyphen support)
        addressFields.forEach(fieldId => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.addEventListener('input', function() {
              const cursorPosition = this.selectionStart;
              this.value = toAddressCase(this.value);
              this.setSelectionRange(cursorPosition, cursorPosition);
            });

            // Also handle paste events
            field.addEventListener('paste', function() {
              setTimeout(() => {
                this.value = toAddressCase(this.value);
              }, 0);
            });
          }
        });
      });

      function hideSidebar() {
        const sidebar = document.getElementById("sidebar");
        const welcomeCard = document.getElementById("welcome-card");
        const mainContent = document.querySelector(".main-content");

        if (window.innerWidth <= 768) {
          sidebar.classList.add("hidden");
          welcomeCard.style.left = "0";
          mainContent.style.marginLeft = "0";
        } else {
          sidebar.style.display = "none";
          welcomeCard.style.left = "0";
          mainContent.style.marginLeft = "0";
        }
        document.getElementById("showBtn").style.display = "block";
      }

      function showSidebar() {
        const sidebar = document.getElementById("sidebar");
        const welcomeCard = document.getElementById("welcome-card");
        const mainContent = document.querySelector(".main-content");

        sidebar.classList.remove("hidden");
        sidebar.style.display = "block";

        if (window.innerWidth > 768) {
          welcomeCard.style.left = "16.666667%";
          mainContent.style.marginLeft = "16.666667%";
        } else {
          welcomeCard.style.left = "0";
          mainContent.style.marginLeft = "0";
        }
        document.getElementById("showBtn").style.display = "none";
      }

      // Handle window resize
      window.addEventListener('resize', function() {
        const sidebar = document.getElementById("sidebar");
        const welcomeCard = document.getElementById("welcome-card");
        const mainContent = document.querySelector(".main-content");

        if (window.innerWidth > 768) {
          if (!sidebar.classList.contains("hidden")) {
            welcomeCard.style.left = "16.666667%";
            mainContent.style.marginLeft = "16.666667%";
          }
        } else {
          welcomeCard.style.left = "0";
          mainContent.style.marginLeft = "0";
        }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    {% include 'footer.html' %}
  </body>
</html>
